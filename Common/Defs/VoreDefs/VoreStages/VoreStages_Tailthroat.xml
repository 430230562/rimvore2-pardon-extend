<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 它不应该出现在这里,不过我懒得单开文件 -->
  <RimVore2.VoreStageDef ParentName="Tailmaw_Exit">
    <defName>Tailmaw_Dump</defName>
    <partGoal>Dump</partGoal>
    <canReverseDirection>false</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailmawDumping</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailmawDumping</predatorThoughtDef>
  </RimVore2.VoreStageDef>

  <!-- Warmup -->
  <RimVore2.VoreStageDef MayRequire='MamaHorseteeth.RimVore2ExtraVores' ParentName="Tailthroat_Base">
    <defName>TailThroat_Warmup</defName>
    <partGoal>WarmUp</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatWarming</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatWarming</predatorThoughtDef>
    <jumpKey>TailThroat</jumpKey>
    <onCycle>
      <rollPresets>
        <li>Sound_Churn_10</li>
      </rollPresets>
    </onCycle>
    <passConditions>
      <!-- ESEGN: Changed to warmup pass condition -->
      <li Class="RimVore2.StagePassCondition_Warmup">
        <duration>24</duration>
        <hediffs>
          <li>RV2_PreyInTailThroatDigesting</li>
          <li>RV2_PreyInTailThroatHealing</li>
        </hediffs>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!-- Digest -->
  <RimVore2.VoreStageDef MayRequire='MamaHorseteeth.RimVore2ExtraVores' ParentName="Tailthroat_Base">
    <defName>TailThroat_Digest</defName>
    <partGoal>Digest</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatDigesting</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatDigesting</predatorThoughtDef>
    <jumpKey>TailThroat</jumpKey>
    <onStart>
      <actions>
        <li Class="RimVore2.RollAction_PassValue_Set">
          <name>DigestionProgress</name>
          <type>DigestionProgress</type>
        </li>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_BubbleDigest</mote>
        </li>
      </actions>
    </onStart>
    <onCycle>
      <rollPresets>
        <li>Mote_BubbleDigest</li>
        <li>Sound_Gurgle_Chance_5</li>
        <li>Sound_Burp_Chance_15</li>
        <li>IncreaseDigestionProgress</li>
        <li>IncreaseNeed_Predator_Food</li>
      </rollPresets>
    </onCycle>
    <onEnd>
      <actions>
        <li Class="RimVore2.RollAction_PlaySound">
          <sound>RV2_Belch</sound>
        </li>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_Skull</mote>
        </li>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_BubblesDigest</mote>
        </li>
        <li Class="RimVore2.RollAction_Digest">
          <damageDef>RV2_StomachAcid</damageDef>
        </li>
        <li Class="RimVore2.RollAction_RecordTale_GoalFinish"/>
      </actions>
    </onEnd>
    <passConditions>
      <li Class="RimVore2.StagePassCondition_PassValue">
        <passValueName>DigestionProgress</passValueName>
        <targetValue>1</targetValue>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!-- Heal -->
  <RimVore2.VoreStageDef MayRequire='MamaHorseteeth.RimVore2ExtraVores' ParentName="Tailthroat_Base">
    <defName>TailThroat_Heal</defName>
    <partGoal>Heal</partGoal>
    <jumpKey>TailThroat</jumpKey>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatHealing</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatHealing</predatorThoughtDef>
    <onCycle>
      <rollPresets>
        <li>Sound_Churn_10</li>
        <li>IncreaseNeed_Prey_Rest</li>
        <li>StealNeed_ForPrey_Food</li>
        <li>Heal_Prey</li>
        <!-- actions are interrupted here if predator has no food for healing -->
        <li>Mote_Heal</li>
      </rollPresets>
    </onCycle>
    <onEnd>
      <actions>
        <li Class="RimVore2.RollAction_RecordTale_GoalFinish" />
      </actions>
    </onEnd>
    <passConditions>
      <li Class="RimVore2.StagePassCondition_Healed">
        <target>Prey</target>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!--Contact -->
  <RimVore2.VoreStageDef Name="TailThroat_Contact" ParentName="TailThroat_Enter">
    <defName>TailThroat_Contact</defName>
    <partGoal>Contact</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatContacting</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatContacting</predatorThoughtDef>
    <onCycle>
      <rollPresets>
        <li>Sound_Squish_Chance_5</li>
        <li>Sound_Slurp_Chance_5</li>
        <li>IncreaseNeed_Predator_Comfort</li>
      </rollPresets>
    </onCycle>
    <passConditions Inherit="False">
      <li Class="RimVore2.StagePassCondition_Timed">
        <duration>12</duration>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!--Loosen -->
  <RimVore2.VoreStageDef Name="TailThroat_Loosen" ParentName="TailThroat_Base">
    <defName>TailThroat_Loosen</defName>
    <partGoal>Loosen</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatLoosening</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatLoosening</predatorThoughtDef>
    <onStart>
      <actions>
        <li Class="RimVore2.RollAction_PlaySound">
          <sound>RV2_Slurp</sound>
        </li>
      </actions>
    </onStart>
    <onCycle>
      <rollPresets>
        <li>Sound_Squish_Chance_5</li>
        <li>Sound_Slurp_Chance_5</li>
      </rollPresets>
    </onCycle>
    <onEnd>
      <actions>
        <li Class="RimVore2.RollAction_PlaySound">
          <sound>RV2_Slurp</sound>
        </li>
      </actions>
    </onEnd>
    <passConditions>
      <!-- ESEGN: Changed to warmup pass condition -->
      <li Class="RimVore2.StagePassCondition_Warmup">
        <duration>12</duration>
        <hediffs>
          <li>RV2_PreyInTailThroatAssimilating</li>
        </hediffs>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!-- storing absorbed -->
  <RimVore2.VoreStageDef Name="TailThroat_Amalgamate" ParentName="TailThroat_Base">
    <defName>TailThroat_Amalgamate</defName>
    <partGoal>Amalgamate</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatAmalgamating</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatAmalgamating</predatorThoughtDef>
    <onStart>
      <actions>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_KnotPink</mote>
        </li>
      </actions>
    </onStart>
    <onCycle>
      <rollPresets>
        <li>Sound_Squish_Chance_30</li>
        <li>IncreaseNeed_Prey_Rest</li>
        <li>StealNeed_ForPrey_Food</li>
      </rollPresets>
    </onCycle>
    <onEnd>
      <actions>
        <li Class="RimVore2.RollAction_RecordTale_GoalFinish"/>
      </actions>
    </onEnd>
    <passConditions>
      <li Class="RimVore2.StagePassCondition_Manual"/>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!-- fully-absorbing -->
  <RimVore2.VoreStageDef Name="TailThroat_Assimilate" ParentName="TailThroat_Base">
    <defName>TailThroat_Assimilate</defName>
    <partGoal>Assimilate</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatAssimilating</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatAssimilating</predatorThoughtDef>
    <onStart>
      <actions>
        <li Class="RimVore2.RollAction_PassValue_Set">
          <name>PreyNutrition</name>
          <type>PreyNutrition</type>
        </li>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_KnotPink</mote>
        </li>
      </actions>
    </onStart>
    <onCycle>
      <rollPresets>
        <li>Mote_KnotPink</li>
        <li>Sound_Churn_Chance_5</li>
        <li>Sound_Squish_Chance_5</li>
        <li>Sound_Moan_Chance_15</li>
        <li>ConvertNutritionToPredatorFood</li>
      </rollPresets>
    </onCycle>
    <onEnd>
      <actions>
        <li Class="RimVore2.RollAction_Digest">
          <damageDef>RV2_AssimilationAvulsion</damageDef>
        </li>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_Skull</mote>
        </li>
        <li Class="RimVore2.RollAction_ShowMote">
          <mote>RV2_Mote_KnotPink</mote>
        </li>
        <li Class="RimVore2.RollAction_RecordTale_GoalFinish"/>
      </actions>
    </onEnd>
    <passConditions>
      <li Class="RimVore2.StagePassCondition_PassValue">
        <passValueName>PreyNutrition</passValueName>
        <targetValue>0</targetValue>
        <decreasing>true</decreasing>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!--Reshape -->
  <RimVore2.VoreStageDef Name="TailThroat_Reshape" ParentName="TailThroat_Exit">
    <defName>TailThroat_Reshape</defName>
    <partGoal>Reshape</partGoal>
    <canReverseDirection>true</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatReshaping</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatReshaping</predatorThoughtDef>
    <onCycle>
      <rollPresets>
        <li>IncreaseNeed_Predator_Comfort</li>
      </rollPresets>
    </onCycle>
    <passConditions Inherit="False">
      <li Class="RimVore2.StagePassCondition_Timed">
        <duration>16</duration>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

  <!-- Purge -->
  <RimVore2.VoreStageDef Name="TailThroat_Purge" ParentName="TailThroat_Exit">
    <defName>TailThroat_Purge</defName>
    <partGoal>Purge</partGoal>
    <canReverseDirection>false</canReverseDirection>
    <predatorHediffDef>RV2_PreyInTailThroatPurging</predatorHediffDef>
    <predatorThoughtDef>RV2_PreyInTailThroatPurging</predatorThoughtDef>
    <onCycle>
      <rollPresets>
        <li>IncreaseNeed_Predator_Comfort</li>
      </rollPresets>
    </onCycle>
    <passConditions Inherit="False">
      <li Class="RimVore2.StagePassCondition_Timed">
        <duration>16</duration>
      </li>
    </passConditions>
  </RimVore2.VoreStageDef>

</Defs>